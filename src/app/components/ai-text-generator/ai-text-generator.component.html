<div class="ai-chat-container">
  <!-- Header -->
  <div class="chat-header">
    <div class="header-content">
      <div class="ai-avatar">
        <div class="avatar-icon">ğŸ¤–</div>
        <div class="status-indicator"></div>
      </div>
      <div class="header-info">
        <h1>AI æ™ºèƒ½åŠ©æ‰‹</h1>
        <p class="status-text">åŸºäº Gemini AI Â· åœ¨çº¿</p>
      </div>
    </div>

    <!-- Type Selector -->
    <div class="type-selector-compact">
      <select [(ngModel)]="selectedType" (change)="onTypeChange()" class="type-select">
        <option *ngFor="let type of textTypes" [value]="type.value">
          {{ type.icon }} {{ type.label }}
        </option>
      </select>
    </div>
  </div>

  <!-- Chat Messages Area -->
  <div class="chat-messages" #chatMessages>
    <div class="messages-container">
      <!-- Welcome Message -->
      <div class="message ai-message" *ngIf="messages.length === 0">
        <div class="message-avatar">
          <div class="avatar-icon">ğŸ¤–</div>
        </div>
        <div class="message-content">
          <div class="message-header">
            <span class="sender-name">AI åŠ©æ‰‹</span>
            <span class="message-time">{{ currentTime }}</span>
          </div>
          <div class="message-text">
            <p>ä½ å¥½ï¼æˆ‘æ˜¯AIæ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥å¸®ä½ ç”Ÿæˆå„ç§ç±»å‹çš„å†…å®¹ï¼š</p>
            <div class="capability-list">
              <div class="capability-item" *ngFor="let type of textTypes" (click)="selectTypeAndShowExamples(type.value)">
                <span class="capability-icon">{{ type.icon }}</span>
                <span class="capability-name">{{ type.label }}</span>
              </div>
            </div>
            <p class="help-text">é€‰æ‹©ä¸€ä¸ªç±»å‹å¼€å§‹ï¼Œæˆ–è€…ç›´æ¥è¾“å…¥ä½ çš„éœ€æ±‚ï¼</p>
          </div>
        </div>
      </div>

      <!-- Chat Messages -->
      <div *ngFor="let message of messages; let i = index"
           class="message"
           [class.user-message]="message.type === 'user'"
           [class.ai-message]="message.type === 'ai'">

        <div class="message-avatar" *ngIf="message.type === 'ai'">
          <div class="avatar-icon">ğŸ¤–</div>
        </div>

        <div class="message-content">
          <div class="message-header">
            <span class="sender-name">{{ message.type === 'user' ? 'ä½ ' : 'AI åŠ©æ‰‹' }}</span>
            <span class="message-time">{{ message.timestamp }}</span>
          </div>
          <div class="message-text" [innerHTML]="formatMessage(message.content, message.contentType)"></div>

          <!-- Message Actions -->
          <div class="message-actions" *ngIf="message.type === 'ai' && message.content">
            <button class="action-btn" (click)="copyMessage(message.content)" title="å¤åˆ¶">
              <span class="icon">ğŸ“‹</span>
            </button>
            <button class="action-btn" (click)="regenerateMessage(i)" title="é‡æ–°ç”Ÿæˆ">
              <span class="icon">ğŸ”„</span>
            </button>
            <button class="action-btn" (click)="likeMessage(i)" title="ç‚¹èµ"
                    [class.liked]="message.liked">
              <span class="icon">ğŸ‘</span>
            </button>
          </div>
        </div>

        <div class="message-avatar" *ngIf="message.type === 'user'">
          <div class="avatar-icon user-avatar">ğŸ‘¤</div>
        </div>
      </div>

      <!-- Loading Message -->
      <div class="message ai-message" *ngIf="isGenerating">
        <div class="message-avatar">
          <div class="avatar-icon">ğŸ¤–</div>
        </div>
        <div class="message-content">
          <div class="message-header">
            <span class="sender-name">AI åŠ©æ‰‹</span>
            <span class="message-time">æ­£åœ¨è¾“å…¥...</span>
          </div>
          <div class="message-text">
            <div class="typing-indicator">
              <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
              </div>
              <span class="typing-text">æ­£åœ¨æ€è€ƒä¸­...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Example Prompts (when type is selected) -->
  <div class="example-prompts" *ngIf="showExamples">
    <div class="examples-header">
      <span>ğŸ’¡ {{ getSelectedTypeInfo()?.label }} ç¤ºä¾‹</span>
      <button class="close-examples" (click)="hideExamples()">âœ•</button>
    </div>
    <div class="prompt-chips">
      <div *ngFor="let example of examplePrompts[selectedType]"
           class="prompt-chip"
           (click)="useExamplePrompt(example)">
        {{ example }}
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="chat-input-area">
    <!-- Advanced Settings -->
    <div class="advanced-settings" [class.expanded]="showAdvancedSettings">
      <div class="settings-row">
        <div class="setting-group">
          <label>æœ€å¤§é•¿åº¦: {{ maxLength }}</label>
          <input type="range" [(ngModel)]="maxLength" min="100" max="2000" step="100" class="setting-slider">
        </div>
        <div class="setting-group">
          <label>åˆ›é€ æ€§: {{ temperature }}</label>
          <input type="range" [(ngModel)]="temperature" min="0.1" max="1.0" step="0.1" class="setting-slider">
        </div>
      </div>
    </div>

    <!-- Input Box -->
    <div class="input-container">
      <div class="input-wrapper">
        <textarea
          [(ngModel)]="prompt"
          (keydown)="onKeyDown($event)"
          placeholder="è¾“å…¥ä½ çš„é—®é¢˜æˆ–éœ€æ±‚..."
          class="chat-input"
          rows="1"
          #chatInput></textarea>

        <div class="input-actions">
          <button class="settings-btn"
                  (click)="toggleAdvancedSettings()"
                  [class.active]="showAdvancedSettings"
                  title="é«˜çº§è®¾ç½®">
            âš™ï¸
          </button>

          <button class="send-btn"
                  (click)="sendMessage()"
                  [disabled]="!prompt.trim() || isGenerating"
                  title="å‘é€">
            <span *ngIf="!isGenerating">ğŸš€</span>
            <span *ngIf="isGenerating" class="loading-icon">â³</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="dashboard-container">
  <!-- ä»ªè¡¨æ¿æ ‡é¢˜ -->
  <div class="dashboard-header">
    <div class="header-content">
      <h2 class="dashboard-title">
        <span class="title-icon">ğŸ“Š</span>
        å®æ—¶æ•°æ®ä»ªè¡¨æ¿
      </h2>
      <p class="dashboard-subtitle">ä¸ªäººæ•°æ®ä¸­å¿ƒ - å®æ—¶ç›‘æ§ä¸åˆ†æ</p>
    </div>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="dashboard-controls">
      <div class="control-group">
        <label class="control-label">æ—¶é—´èŒƒå›´:</label>
        <select [(ngModel)]="selectedTimeRange" class="control-select">
          <option *ngFor="let range of timeRanges" [value]="range.value">
            {{ range.label }}
          </option>
        </select>
      </div>
      
      <div class="control-group">
        <label class="control-label">åˆ·æ–°é—´éš”:</label>
        <select [(ngModel)]="refreshInterval" (change)="onRefreshIntervalChange()" class="control-select">
          <option *ngFor="let interval of refreshIntervals" [value]="interval.value">
            {{ interval.label }}
          </option>
        </select>
      </div>
      
      <div class="control-group">
        <button (click)="toggleAutoRefresh()" class="auto-refresh-btn" [class.active]="autoRefresh">
          <span class="btn-icon">{{ autoRefresh ? 'â¸ï¸' : 'â–¶ï¸' }}</span>
          {{ autoRefresh ? 'æš‚åœ' : 'å¼€å§‹' }}
        </button>
      </div>
      
      <div class="control-group">
        <button (click)="refresh()" class="refresh-btn" [disabled]="loading">
          <span class="btn-icon">ğŸ”„</span>
          åˆ·æ–°
        </button>
      </div>
    </div>
  </div>

  <!-- æœ€åæ›´æ–°æ—¶é—´ -->
  <div class="update-info">
    <span class="update-text">æœ€åæ›´æ–°: {{ formatTime(lastUpdated) }}</span>
    <div class="status-indicator" [class.loading]="loading" [class.error]="error">
      <span class="status-dot"></span>
      <span class="status-text">
        {{ loading ? 'æ›´æ–°ä¸­...' : error ? 'è¿æ¥å¼‚å¸¸' : 'å®æ—¶åŒæ­¥' }}
      </span>
    </div>
  </div>

  <!-- åŠ è½½çŠ¶æ€ -->
  <div *ngIf="loading && !metrics.github" class="loading-state">
    <div class="loading-spinner"></div>
    <p class="loading-text">æ­£åœ¨åŠ è½½ä»ªè¡¨æ¿æ•°æ®...</p>
  </div>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <div *ngIf="error && !loading" class="error-state">
    <div class="error-icon">âš ï¸</div>
    <p class="error-text">æ•°æ®åŠ è½½å¤±è´¥</p>
    <button (click)="refresh()" class="retry-btn">é‡è¯•</button>
  </div>

  <!-- ä»ªè¡¨æ¿å†…å®¹ -->
  <div *ngIf="!loading || metrics.github" class="dashboard-content">
    
    <!-- ç¬¬ä¸€è¡Œï¼šæ ¸å¿ƒæŒ‡æ ‡ -->
    <div class="metrics-row">
      <!-- GitHub ç»Ÿè®¡ -->
      <div class="metric-card github-card">
        <div class="card-header">
          <h3 class="card-title">
            <span class="card-icon">ğŸ™</span>
            GitHub æ´»åŠ¨
          </h3>
          <div class="card-status" [class]="getStatusClass('healthy')">
            <span class="status-dot"></span>
            å®æ—¶
          </div>
        </div>
        
        <div *ngIf="metrics.github" class="card-content">
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-value">{{ metrics.github.user.public_repos }}</div>
              <div class="stat-label">ä»“åº“</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ formatNumber(metrics.github.totalStars) }}</div>
              <div class="stat-label">æ˜Ÿæ ‡</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ formatNumber(metrics.github.totalForks) }}</div>
              <div class="stat-label">Fork</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ formatNumber(metrics.github.user.followers) }}</div>
              <div class="stat-label">å…³æ³¨è€…</div>
            </div>
          </div>
          
          <div class="languages-chart">
            <h4 class="chart-title">ç¼–ç¨‹è¯­è¨€åˆ†å¸ƒ</h4>
            <div class="languages-list">
              <div *ngFor="let lang of metrics.github.languages | keyvalue | slice:0:5" class="language-item">
                <span class="language-name">{{ lang.key }}</span>
                <span class="language-count">{{ lang.value }}</span>
              </div>
            </div>
          </div>
        </div>
        
        <div *ngIf="!metrics.github" class="card-loading">
          <div class="loading-spinner small"></div>
          <span>åŠ è½½ä¸­...</span>
        </div>
      </div>

      <!-- ç³»ç»Ÿå¥åº· -->
      <div class="metric-card health-card">
        <div class="card-header">
          <h3 class="card-title">
            <span class="card-icon">ğŸ’š</span>
            ç³»ç»Ÿå¥åº·
          </h3>
          <div class="card-status" [class]="getStatusClass(metrics.systemHealth.status)">
            <span class="status-dot"></span>
            {{ metrics.systemHealth.status === 'healthy' ? 'å¥åº·' : 
               metrics.systemHealth.status === 'warning' ? 'è­¦å‘Š' : 'ä¸¥é‡' }}
          </div>
        </div>
        
        <div class="card-content">
          <div class="health-metrics">
            <div class="health-item">
              <div class="health-label">è¿è¡Œæ—¶é—´</div>
              <div class="health-value">{{ metrics.systemHealth.uptime }}å¤©</div>
            </div>
            <div class="health-item">
              <div class="health-label">å“åº”æ—¶é—´</div>
              <div class="health-value">{{ metrics.systemHealth.responseTime }}ms</div>
            </div>
            <div class="health-item">
              <div class="health-label">é”™è¯¯ç‡</div>
              <div class="health-value">{{ metrics.systemHealth.errorRate.toFixed(2) }}%</div>
            </div>
          </div>
          
          <div class="usage-bars">
            <div class="usage-item">
              <div class="usage-label">å†…å­˜ä½¿ç”¨</div>
              <div class="usage-bar">
                <div class="usage-fill" [style.width.%]="metrics.systemHealth.memoryUsage"></div>
              </div>
              <div class="usage-value">{{ metrics.systemHealth.memoryUsage }}%</div>
            </div>
            <div class="usage-item">
              <div class="usage-label">CPUä½¿ç”¨</div>
              <div class="usage-bar">
                <div class="usage-fill" [style.width.%]="metrics.systemHealth.cpuUsage"></div>
              </div>
              <div class="usage-value">{{ metrics.systemHealth.cpuUsage }}%</div>
            </div>
          </div>
        </div>
      </div>

      <!-- ç½‘ç«™ç»Ÿè®¡ -->
      <div class="metric-card website-card">
        <div class="card-header">
          <h3 class="card-title">
            <span class="card-icon">ğŸ“ˆ</span>
            ç½‘ç«™ç»Ÿè®¡
          </h3>
          <div class="card-status" [class]="getStatusClass('active')">
            <span class="status-dot"></span>
            {{ selectedTimeRange }}
          </div>
        </div>
        
        <div class="card-content">
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-value">{{ formatNumber(metrics.websiteStats.visitors) }}</div>
              <div class="stat-label">è®¿å®¢</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ formatNumber(metrics.websiteStats.pageViews) }}</div>
              <div class="stat-label">é¡µé¢æµè§ˆ</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ metrics.websiteStats.bounceRate }}%</div>
              <div class="stat-label">è·³å‡ºç‡</div>
            </div>
            <div class="stat-item">
              <div class="stat-value">{{ Math.floor(metrics.websiteStats.avgSessionDuration / 60) }}m</div>
              <div class="stat-label">å¹³å‡åœç•™</div>
            </div>
          </div>
          
          <div class="top-pages">
            <h4 class="chart-title">çƒ­é—¨é¡µé¢</h4>
            <div class="pages-list">
              <div *ngFor="let page of metrics.websiteStats.topPages" class="page-item">
                <span class="page-path">{{ page.path }}</span>
                <span class="page-views">{{ formatNumber(page.views) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ç¬¬äºŒè¡Œï¼šæŠ€èƒ½ä¸é¡¹ç›®è¿›åº¦ -->
    <div class="progress-row">
      <!-- æŠ€èƒ½è¿›åº¦ -->
      <div class="progress-card skills-card">
        <div class="card-header">
          <h3 class="card-title">
            <span class="card-icon">ğŸ¯</span>
            æŠ€èƒ½æˆé•¿è½¨è¿¹
          </h3>
          <div class="card-actions">
            <button class="action-btn">æŸ¥çœ‹è¯¦æƒ…</button>
          </div>
        </div>
        
        <div class="card-content">
          <div class="skills-list">
            <div *ngFor="let skill of metrics.skills" class="skill-item">
              <div class="skill-header">
                <span class="skill-name">{{ skill.name }}</span>
                <span class="skill-trend">{{ getTrendIcon(skill.trend) }}</span>
                <span class="skill-level">Lv.{{ skill.level }}</span>
              </div>
              <div class="skill-progress">
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="skill.progress"></div>
                </div>
                <span class="progress-value">{{ skill.progress }}%</span>
              </div>
              <div class="skill-meta">
                <span class="skill-category">{{ skill.category }}</span>
                <span class="skill-updated">{{ formatRelativeTime(skill.lastUpdated) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- é¡¹ç›®è¿›åº¦ -->
      <div class="progress-card projects-card">
        <div class="card-header">
          <h3 class="card-title">
            <span class="card-icon">ğŸš€</span>
            é¡¹ç›®è¿›åº¦è¿½è¸ª
          </h3>
          <div class="card-actions">
            <button class="action-btn">ç®¡ç†é¡¹ç›®</button>
          </div>
        </div>
        
        <div class="card-content">
          <div class="projects-list">
            <div *ngFor="let project of metrics.projects" class="project-item">
              <div class="project-header">
                <span class="project-name">{{ project.name }}</span>
                <span class="project-status" [class]="getStatusClass(project.status)">
                  {{ project.status === 'active' ? 'è¿›è¡Œä¸­' : 
                     project.status === 'completed' ? 'å·²å®Œæˆ' : 
                     project.status === 'paused' ? 'æš‚åœ' : 'è®¡åˆ’ä¸­' }}
                </span>
              </div>
              <div class="project-progress">
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="project.completion"></div>
                </div>
                <span class="progress-value">{{ project.completion }}%</span>
              </div>
              <div class="project-stats">
                <span class="project-stat">
                  <span class="stat-icon">â­</span>
                  {{ project.stars }}
                </span>
                <span class="project-stat">
                  <span class="stat-icon">ğŸ›</span>
                  {{ project.issues }}
                </span>
                <span class="project-stat">
                  <span class="stat-icon">ğŸ‘¥</span>
                  {{ project.contributors }}
                </span>
                <span class="project-stat">
                  <span class="stat-icon">ğŸ“</span>
                  {{ formatRelativeTime(project.lastCommit) }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ç¬¬ä¸‰è¡Œï¼šå¤©æ°”ä¸å…¶ä»–ä¿¡æ¯ -->
    <div class="info-row">
      <!-- å¤©æ°”ä¿¡æ¯ -->
      <div class="info-card weather-card" *ngIf="metrics.weather">
        <div class="card-header">
          <h3 class="card-title">
            <span class="card-icon">ğŸŒ¤ï¸</span>
            å½“å‰å¤©æ°”
          </h3>
          <div class="weather-location">{{ metrics.weather.location }}</div>
        </div>
        
        <div class="card-content">
          <div class="weather-main">
            <div class="weather-icon">{{ metrics.weather.weatherIcon }}</div>
            <div class="weather-temp">{{ metrics.weather.temperature }}Â°C</div>
            <div class="weather-desc">{{ metrics.weather.weatherDescription }}</div>
          </div>
          <div class="weather-details">
            <div class="weather-detail">
              <span class="detail-label">å¤©æ°”ä»£ç </span>
              <span class="detail-value">{{ metrics.weather.weatherCode }}</span>
            </div>
            <div class="weather-detail">
              <span class="detail-label">æ¹¿åº¦</span>
              <span class="detail-value">{{ metrics.weather.humidity }}%</span>
            </div>
            <div class="weather-detail">
              <span class="detail-label">é£é€Ÿ</span>
              <span class="detail-value">{{ metrics.weather.windSpeed }} km/h</span>
            </div>
          </div>
        </div>
      </div>

      <!-- æµé‡æ¥æº -->
      <div class="info-card traffic-card">
        <div class="card-header">
          <h3 class="card-title">
            <span class="card-icon">ğŸŒ</span>
            æµé‡æ¥æº
          </h3>
        </div>
        
        <div class="card-content">
          <div class="traffic-list">
            <div *ngFor="let referrer of metrics.websiteStats.referrers" class="traffic-item">
              <span class="traffic-source">{{ referrer.source }}</span>
              <div class="traffic-bar">
                <div class="traffic-fill" 
                     [style.width.%]="(referrer.visits / metrics.websiteStats.referrers[0].visits) * 100">
                </div>
              </div>
              <span class="traffic-visits">{{ formatNumber(referrer.visits) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- å¿«é€Ÿæ“ä½œ -->
      <div class="info-card actions-card">
        <div class="card-header">
          <h3 class="card-title">
            <span class="card-icon">âš¡</span>
            å¿«é€Ÿæ“ä½œ
          </h3>
        </div>
        
        <div class="card-content">
          <div class="actions-grid">
            <button class="action-item">
              <span class="action-icon">ğŸ“Š</span>
              <span class="action-label">è¯¦ç»†åˆ†æ</span>
            </button>
            <button class="action-item">
              <span class="action-icon">ğŸ“ˆ</span>
              <span class="action-label">ç”ŸæˆæŠ¥å‘Š</span>
            </button>
            <button class="action-item">
              <span class="action-icon">âš™ï¸</span>
              <span class="action-label">è®¾ç½®å‘Šè­¦</span>
            </button>
            <button class="action-item">
              <span class="action-icon">ğŸ“¤</span>
              <span class="action-label">å¯¼å‡ºæ•°æ®</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
